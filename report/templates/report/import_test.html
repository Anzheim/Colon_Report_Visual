<!-- templates/import_data.html -->
{% extends "base.html" %}

{% block content %}
    <h1>新增病歷資料</h1>
    <form method='POST' enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" id="file_input" name="file_field" webkitdirectory directory/>
        <input type="text" id="directories" name="directories" hidden />
        <input type="submit"/>
    </form>
    <script>
        document.getElementById('folder-upload').addEventListener('change', function(e){
            folderName = "";
            console.log(event.target.files);
            for(file of event.target.files){
                console.log(file.name)
                console.log(file.webkitRelativePath);
                folderName += file.webkitRelativePath.split('/')[1]+'/'+file.webkitRelativePath.split('/')[2]+'<br>';
            }
            folderName += '====================<br>';
            document.getElementById('folder-name').innerHTML = "上傳檔案預覽: <br>" + folderName;
        });
        document.getElementById('upload-form').addEventListener('submit', function (event) {
            var input = document.getElementById('folder-upload');
            if (input.files.length === 0) {
                alert('請選擇一個文件夾!');
                event.preventDefault();
            }
        });
        files = document.querySelector("#file_input").files;
        document.querySelector("#file_input").addEventListener("change", function() {
           files = document.querySelector("#file_input").files;
           var directories = {}
           for (var file of files) {
             file.webkitRelativePath
             directories[file.name] = file.webkitRelativePath
           }
           directories = JSON.stringify(directories);
           document.querySelector("#directories").value = directories
        });
    </script>

    <p>{{ result }}</p>
{% endblock %}